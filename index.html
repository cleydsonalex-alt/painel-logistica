<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogisticsInsight | Link Direto</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; color: #1e293b; margin: 0; }
        .navbar { background: white; border-bottom: 1px solid #e2e8f0; padding: 1rem; }
        .card-kpi { background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; background: #22c55e; }
        .next-up { background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 12px; border-radius: 8px; }
        .badge-uf { background: #e2e8f0; color: #475569; font-weight: 700; font-size: 0.7rem; padding: 4px 8px; border-radius: 4px; }
    </style>
</head>
<body>
<nav class="navbar mb-4"><div class="container d-flex justify-content-between">
    <span class="fw-bold text-primary fs-4">LogisticsInsight</span>
    <div id="status" class="small fw-bold text-muted">CONECTANDO...</div>
</div></nav>

<div class="container">
    <div class="row text-center mb-4">
        <div class="col-4"><div class="card-kpi"><small>VISITAS</small><h2 id="kpiVisitas">0</h2></div></div>
        <div class="col-4"><div class="card-kpi"><small>INSTAL.</small><h2 id="kpiInstalacoes" class="text-success">0</h2></div></div>
        <div class="col-4"><div class="card-kpi"><small>TÉCNICOS</small><h2 id="kpiTotal" class="text-primary">0</h2></div></div>
    </div>
    
    <div class="card-kpi mb-4 border-info">
        <h6 class="text-info fw-bold">PRÓXIMOS (RODÍZIO)</h6>
        <div class="row g-2">
            <div class="col-6"><div class="next-up"><small>PRÓX. VT:</small><br><b id="nextVT">...</b></div></div>
            <div class="col-6"><div class="next-up" style="border-left-color:#10b981"><small>PRÓX. INST:</small><br><b id="nextInst">...</b></div></div>
        </div>
    </div>

    <div class="card-kpi p-0 overflow-hidden shadow-sm">
        <table class="table align-middle mb-0"><thead class="table-light"><tr><th class="ps-3">DATA</th><th>CLIENTE</th><th>UF</th><th>TÉCNICO</th></tr></thead><tbody id="tableBody"></tbody></table>
    </div>
</div>

<script>
    // COLE AQUI O LINK QUE VOCÊ COPIOU NO PASSO 9
    const SCRIPT_URL = 'COLE_AQUI_O_LINK_DO_GOOGLE_APPS_SCRIPT';
    
    const TECS = ["TEC cleydson Ceará", "TEC Daniel", "TEC Franklin", "TEC Dervis", "TEC Rodrigo", "TEC Marcus", "TEC instalador Ricardo", "TEC instalador Pedro"];

    async function fetchData() {
        try {
            const response = await fetch(SCRIPT_URL);
            const data = await response.json();
            // Remove o cabeçalho
            const rows = data.slice(1);
            
            const rawData = rows.map(r => ({ tec: r[0], uf: r[1], atividade: r[2], data: r[3], cliente: r[4] }));
            
            document.getElementById('kpiVisitas').innerText = rawData.filter(d => String(d.atividade).toLowerCase().includes("visita")).length;
            document.getElementById('kpiInstalacoes').innerText = rawData.filter(d => String(d.atividade).toLowerCase().includes("instala")).length;
            document.getElementById('kpiTotal').innerText = [...new Set(rawData.map(d => d.tec))].filter(t => t).length;

            const getNext = (tipo) => {
                const hist = rawData.filter(d => String(d.atividade).toLowerCase().includes(tipo.toLowerCase())).reverse();
                if (!hist.length) return TECS[0];
                const last = hist[0].tec;
                const idx = TECS.indexOf(last);
                return TECS[(idx + 1) % TECS.length];
            };

            document.getElementById('nextVT').innerText = getNext("visita");
            document.getElementById('nextInst').innerText = getNext("instala");
            document.getElementById('tableBody').innerHTML = rawData.slice(-20).reverse().map(r => `<tr><td class="ps-3">${r.data}</td><td><b>${r.cliente}</b></td><td><span class="badge-uf">${r.uf}</span></td><td>${r.tec}</td></tr>`).join('');
            
            document.getElementById('status').innerHTML = '<span class="dot"></span> ONLINE';
        } catch (e) {
            document.getElementById('status').innerText = "ERRO AO BUSCAR DADOS";
        }
    }
    window.onload = fetchData;
</script>
</body>
</html>
